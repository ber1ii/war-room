generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")  
  directUrl = env("DIRECT_URL")   
}

model Incident {
  id              String   @id @default(uuid())
  title           String
  status          String   @default("OPEN")
  severity        String
  createdAt       DateTime @default(now())

  createdBy       String   @default("Unknown")

  events          IncidentEvent[]
  checklistItems  ChecklistItem[]
  snippet         Snippet[]
  secret          Secret[]
}

model IncidentEvent {
  id         String   @id @default(uuid())
  incidentId String
  text       String
  userId     String
  type       String
  createdAt  DateTime @default(now())

  incident   Incident @relation(fields: [incidentId], references: [id], onDelete: Cascade)
}

model ChecklistItem {
  id          String  @id @default(uuid())
  incidentId  String
  text        String
  isCompleted Boolean @default(false)

  incident    Incident @relation(fields: [incidentId], references: [id], onDelete: Cascade)
}

model Snippet {
  id         String   @id @default(uuid())
  title      String
  language   String   @default("javascript")
  code       String
  
  // Lock Mechanic
  lockedBy   String?  // Username of the editor
  lockedAt   DateTime?

  incidentId String
  incident   Incident @relation(fields: [incidentId], references: [id], onDelete: Cascade)

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Secret {
  id         String   @id @default(uuid())
  incidentId String
  label      String   // e.g. "AWS Root Key"
  value      String   // The actual secret
  createdAt  DateTime @default(now())
  expiresAt  DateTime // Self-destruct time
  viewedBy   String[] // Array of usernames who clicked reveal

  incident   Incident @relation(fields: [incidentId], references: [id], onDelete: Cascade)
}
